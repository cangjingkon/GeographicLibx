# $Id$ -*- Makefile -*-
include Makefile.mk

# ssh -t karney,geographiclib@shell.sourceforge.net create

USER=karney
STAGE=$(HOME)/web
WEBSTAGE=$(STAGE)/geographic-web
DATASTAGE=$(STAGE)/geographic-files

geodesic-papers/biblio.html: geodesic-biblio.txt biblio.sh
	sh biblio.sh $< > $@

distrib-html: geodesic-papers/biblio.html
	rsync -av --exclude .svn --exclude '.git*' --exclude '*~' --exclude '#*' --delete --delete-excluded index.html tm.html tm-addenda.html tm-{graticule,grid}.km[lz] geod.html geod-errata.html bessel-errata.html geodesic-papers $(WEBSTAGE)/htdocs/
	rsync --delete -av -e ssh $(WEBSTAGE)/htdocs $(USER),geographiclib@web.sourceforge.net:./

distrib-doc:
	rsync -av --exclude .svn --exclude '.git*' --exclude '*~' --exclude '#*' --delete --delete-excluded doc/html $(WEBSTAGE)/htdocs/
	rsync --delete -av -e ssh $(WEBSTAGE)/htdocs $(USER),geographiclib@web.sourceforge.net:./

distrib-files:
	rsync -av --exclude .svn --exclude '.git*' --delete distrib testdata geoids-distrib $(DATASTAGE)/
	rsync --exclude '*~' --exclude '#*' --exclude .svn --exclude '.git*' --delete --delete-excluded -av -e ssh $(DATASTAGE)/{distrib,testdata,geoids-distrib} $(USER),geographiclib@frs.sourceforge.net:/home/frs/project/g/ge/geographiclib/

distrib-cgi:
	for f in GeoConvert Geod GeoidEval Planimeter printlogs; do \
	  a=cgi-bin/$$f.cgi; b=$(WEBSTAGE)/cgi-bin/$$f; \
	  cmp $$a $$b > /dev/null || install $$a $$b; done
	for f in utils; do \
	  a=cgi-bin/$$f.sh; b=$(WEBSTAGE)/cgi-bin/$$f.sh; \
	  cmp $$a $$b > /dev/null || install -m 644 $$a $$b; done
	rsync --exclude '*~' --exclude '#*' --delete --delete-excluded -av -e ssh $(WEBSTAGE)/{cgi-bin,geoids} $(USER),geographiclib@web.sourceforge.net:./

distrib-js:
	for f in geod-calc.html geod-google{,-instructions}.html \
	GeographicLib/{Math,Geodesic{,Line},PolygonArea,Interface}.js; do \
	  a=doc/scripts/$$f; b=$(WEBSTAGE)/htdocs/scripts/$$f; \
	  cmp $$a $$b > /dev/null || install -m 644 $$a $$b; done
	rsync --exclude '*~' --exclude '#*' --delete --delete-excluded -av -e ssh $(WEBSTAGE)/htdocs/scripts $(USER),geographiclib@web.sourceforge.net:./htdocs/

TAGS:
	for d in include src tools; do \
	  $(MAKE) -s -C $$d list | tr ' ' '\n' | grep -v '/Config\.h$$' | \
	  while read f; do echo $$d/$$f; done; \
	done | xargs etags

.PHONY: distrib-html distrib-doc distrib-files distrib-cgi TAGS


